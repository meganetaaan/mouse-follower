(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();function f(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function S(e,t,i){const n=t.x-e.x,s=t.y-e.y,r=f(e,t);if(r===0)return{x:0,y:0};const o=n/r,a=s/r;return{x:o*i,y:a*i}}function F(e,t,i,n){if(e>=i)return 0;if(e>t){const s=i-t,o=1-(e-t)/s;return n*o}return n}function k(e,t,i){const n=f(e.position,e.target),s=Math.sqrt(e.velocity.x*e.velocity.x+e.velocity.y*e.velocity.y);if(n<=t.stopWithin&&s<=t.minStopVelocity)return{position:e.position,velocity:{x:0,y:0},target:e.target};const r=S(e.position,e.target,t.maxAccel),o=F(n,t.stopWithin,t.brakingStartDistance,t.brakingStrength);let a=e.velocity.x+r.x*i-e.velocity.x*o*i,c=e.velocity.y+r.y*i-e.velocity.y*o*i;const l=Math.sqrt(a*a+c*c);l>t.maxVelocity&&(a=a/l*t.maxVelocity,c=c/l*t.maxVelocity);const d=e.position.x+a*i,m=e.position.y+c*i;return{position:{x:d,y:m},velocity:{x:a,y:c},target:e.target}}function T(e,t){return new Promise((i,n)=>{const s=document.createElement("div"),r=document.createElement("canvas"),o=r.getContext("2d");if(!o){n(new Error("Failed to get canvas 2D context"));return}r.width=t.spriteWidth,r.height=t.spriteHeight,s.style.width=`${t.spriteWidth}px`,s.style.height=`${t.spriteHeight}px`,s.style.position="absolute",s.style.pointerEvents="none",s.appendChild(r),e.appendChild(s);const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const c={element:s,canvas:r,context:o,currentFrame:0,frameCount:t.spriteFrames||2,frameWidth:t.spriteWidth,image:a,facingDirection:"right"};A(c,t.transparentColor),i(c)},a.onerror=()=>{n(new Error(`Failed to load sprite image: ${t.spriteUrl}`))},a.src=t.spriteUrl})}function E(e){const t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(t)return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])];const i=e.match(/^#([0-9a-fA-F]{6})$/);if(i){const n=i[1];return[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16)]}return[0,255,0]}function A(e,t){if(!t){u(e);return}const[i,n,s]=E(t),r=document.createElement("canvas"),o=r.getContext("2d");if(!o)return;r.width=e.image.width,r.height=e.image.height,o.drawImage(e.image,0,0);const a=o.getImageData(0,0,r.width,r.height),c=a.data;for(let l=0;l<c.length;l+=4){const d=c[l],m=c[l+1],b=c[l+2];Math.abs(d-i)<=5&&Math.abs(m-n)<=5&&Math.abs(b-s)<=5&&(c[l+3]=0)}o.putImageData(a,0,0),e.image.onload=()=>u(e),e.image.src=r.toDataURL()}function u(e){const t=e.currentFrame*e.frameWidth;v(e,t,0)}function v(e,t,i,n){e.context.clearRect(0,0,e.canvas.width,e.canvas.height);const s=n??e.facingDirection;e.context.save(),s==="left"?(e.context.scale(-1,1),e.context.drawImage(e.image,t,i,e.frameWidth,e.canvas.height,-e.frameWidth,0,e.frameWidth,e.canvas.height)):e.context.drawImage(e.image,t,i,e.frameWidth,e.canvas.height,0,0,e.frameWidth,e.canvas.height),e.context.restore()}const D={};class M{x=0;y=0;isTracking=!1;constructor(){this.setupMouseTracking()}setupMouseTracking(){this.isTracking||(window.addEventListener("mousemove",t=>{this.x=t.clientX,this.y=t.clientY}),this.isTracking=!0)}}class C{target;offsetX;offsetY;constructor(t,i=0,n=0){this.target=t,this.offsetX=i,this.offsetY=n}get x(){return this.target.x+this.offsetX}get y(){return this.target.y+this.offsetY}}const _={walk:{start:[0,0],numFrames:4,repeat:!0},action:{start:[0,0],numFrames:4,repeat:!1}},x={url:`${typeof import.meta<"u"&&D?"/mouse-follower/":"/"}stack-chan.png`,width:32,height:32,frames:4,transparentColor:"rgb(0, 255, 0)",animation:{interval:125},animations:{walk:{start:[0,0],numFrames:4,repeat:!0,interval:100},action:{start:[0,32],numFrames:4,repeat:!1}}},h={physics:{velocity:400,accel:2e3,braking:{stopDistance:30,distance:200,strength:8,minVelocity:50}},sprite:x};class L{_x=0;_y=0;get x(){return this._x}set x(t){this._x=t,this.physicsState&&(this.physicsState.position.x=t)}get y(){return this._y}set y(t){this._y=t,this.physicsState&&(this.physicsState.position.y=t)}options;physicsState;sprite;animationId;spriteIntervalId;lastTime=0;isRunning=!1;currentAnimation="walk";animationFrame=0;eventTarget=new EventTarget;wasMoving=!1;constructor(t={}){this.options={followTarget:t.target||w(),bindTo:t.bindTo||document.body,maxVelocity:t.physics?.velocity??h.physics.velocity,maxAccel:t.physics?.accel??h.physics.accel,stopWithin:t.physics?.braking?.stopDistance??h.physics.braking.stopDistance,brakingStartDistance:t.physics?.braking?.distance??h.physics.braking.distance,brakingStrength:t.physics?.braking?.strength??h.physics.braking.strength,minStopVelocity:t.physics?.braking?.minVelocity??h.physics.braking.minVelocity,spriteUrl:t.sprite?.url??h.sprite.url??"/ugo-mini.png",spriteFrames:t.sprite?.frames??h.sprite.frames??2,spriteWidth:t.sprite?.width??h.sprite.width??32,spriteHeight:t.sprite?.height??h.sprite.height??64,transparentColor:t.sprite?.transparentColor??h.sprite.transparentColor??"rgb(0, 255, 0)",animationInterval:t.sprite?.animation?.interval??h.sprite.animation?.interval??125,animations:t.sprite?.animations??h.sprite.animations??_};const i=this.options.followTarget.x,n=this.options.followTarget.y;this.physicsState={position:{x:i,y:n},velocity:{x:0,y:0},target:{x:i,y:n}},this._x=i,this._y=n}async start(){if(this.isRunning)return;const t=document.createElement("div");t.className="mouse-follower",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.pointerEvents="none",t.style.zIndex="9999",this.options.bindTo.appendChild(t);try{this.sprite=await T(t,{spriteUrl:this.options.spriteUrl,spriteWidth:this.options.spriteWidth,spriteHeight:this.options.spriteHeight,spriteFrames:this.options.spriteFrames,transparentColor:this.options.transparentColor}),this.lastTime=performance.now(),this.isRunning=!0,this.playAnimation("walk"),this.animate()}catch(i){throw console.error("Failed to create sprite:",i),t.remove(),i}}stop(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0),this.spriteIntervalId&&(clearInterval(this.spriteIntervalId),this.spriteIntervalId=void 0)}setTarget(t){this.options.followTarget=t}destroy(){if(this.stop(),this.sprite){const t=this.sprite.element.parentElement;t&&t.remove(),this.sprite=void 0}}playAnimation(t){const i=this.options.animations[t];if(!i||!this.sprite||(this.spriteIntervalId&&(clearInterval(this.spriteIntervalId),this.spriteIntervalId=void 0),this.currentAnimation=t,this.animationFrame=0,this.renderAnimationFrame(),i.numFrames===1||!i.repeat&&this.animationFrame>=i.numFrames-1))return;const n=i.interval||this.options.animationInterval;this.spriteIntervalId=window.setInterval(()=>{this.sprite&&(this.animationFrame++,this.animationFrame>=i.numFrames&&(i.repeat?this.animationFrame=0:(this.spriteIntervalId&&(clearInterval(this.spriteIntervalId),this.spriteIntervalId=void 0),this.animationFrame=i.numFrames-1)),this.renderAnimationFrame())},n)}pauseAnimation(){this.pauseSpriteAnimation()}renderAnimationFrame(){if(!this.sprite)return;const t=this.options.animations[this.currentAnimation];if(!t)return;const i=t.start[0]+this.animationFrame*this.options.spriteWidth,n=t.start[1];v(this.sprite,i,n,this.sprite.facingDirection)}addEventListener(t,i){this.eventTarget.addEventListener(t,i)}removeEventListener(t,i){this.eventTarget.removeEventListener(t,i)}pauseSpriteAnimation(){this.spriteIntervalId&&(clearInterval(this.spriteIntervalId),this.spriteIntervalId=void 0)}animate=()=>{if(!this.isRunning)return;const t=performance.now(),i=(t-this.lastTime)/1e3;this.lastTime=t;const n=this.getTargetPosition();this.physicsState.target=n;const s={maxAccel:this.options.maxAccel,maxVelocity:this.options.maxVelocity,stopWithin:this.options.stopWithin,brakingStartDistance:this.options.brakingStartDistance,brakingStrength:this.options.brakingStrength,minStopVelocity:this.options.minStopVelocity};if(this.physicsState=k(this.physicsState,s,i),this._x=this.physicsState.position.x,this._y=this.physicsState.position.y,this.sprite){const r=this.physicsState.velocity.x;if(Math.abs(r)>.1){const m=r<0?"left":"right";this.sprite.facingDirection!==m&&(this.sprite.facingDirection=m,this.renderAnimationFrame())}const a=Math.sqrt(this.physicsState.velocity.x*this.physicsState.velocity.x+this.physicsState.velocity.y*this.physicsState.velocity.y)>10;a!==this.wasMoving&&(a?this.eventTarget.dispatchEvent(new CustomEvent("start",{detail:{follower:this}})):this.eventTarget.dispatchEvent(new CustomEvent("stop",{detail:{follower:this}})),this.wasMoving=a);const c=this.sprite.element.parentElement,l=this.x-this.options.spriteWidth/2,d=this.y-this.options.spriteHeight/2;c.style.transform=`translate(${l}px, ${d}px)`}this.animationId=requestAnimationFrame(this.animate)};getTargetPosition(){const t=this.options.followTarget;return{x:t.x,y:t.y}}}let y=null;function W(e){return new L(e)}function w(){return y||(y=new M),y}function V(e,t=0,i=0){return new C(e,t,i)}const g=document.querySelector("#app");g&&(g.innerHTML=`
    <div style="padding: 2rem;">
      <h1>Stack-chan</h1>
			<p>Stack-chan is a palm-sized super-kawaii companion robot with M5Stack embedded. It can shake its head, watch people&apos;s faces, talk, and possess you with various face expressions.</p>
			<p>The exterior, board data, and software are fully open source. Detailed assembly instructions are available, so anyone can make one.</p>
      
      <div style="margin-top: 2rem;">
        <label for="sprite-select">Sprite: </label>
        <select id="sprite-select">
          <option value="stack-chan">Stack-chan</option>
        </select>
        <button id="add">Add</button>
        <button id="clear">Clear</button>
      </div>
      
      <div id="info" style="margin-top: 2rem;">
        <p>Active followers: 0</p>
      </div>
    </div>
  `);const p=[];document.getElementById("add")?.addEventListener("click",async e=>{const t=x,i=p.length===0?w():V(p[p.length-1],-40,0),n=W({target:i,sprite:t});if(n.addEventListener("stop",s=>{s.detail.follower.playAnimation("action")}),n.addEventListener("start",s=>{s.detail.follower.playAnimation("walk")}),p.length===0){const r=e.target.getBoundingClientRect();n.x=r.right+20,n.y=r.top+r.height/2}else{const s=p[p.length-1];n.x=s.x-40,n.y=s.y}await n.start(),p.push(n),I()});document.getElementById("clear")?.addEventListener("click",()=>{p.forEach(e=>e.destroy()),p.length=0,I()});function I(){const e=document.getElementById("info");e&&(e.innerHTML=`<p>Active followers: ${p.length}</p>`)}
